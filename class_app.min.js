class Demineur{constructor(e,t,s){this.lines=e,this.columns=t,this.nb_mines=s,this.first_click=!1,this.game_table=[],this.cases_to_win=0,this.cases_open=0}gridDisplayCreation(){var e=document.getElementById("game_plan"),t=document.getElementById("fin_game_plan"),s=document.createElement("DIV");s.id="game_inner",s.classList.add("text-center","mx-auto"),e.insertBefore(s,t);for(var a=0;a<this.lines;a++){var l=document.createElement("DIV");l.id="line"+a,l.classList.add("line_game_plan","d-flex","flex-row","justify-content-center"),s.appendChild(l);for(var c=0;c<this.columns;c++){var i=document.createElement("DIV");i.id="l"+a+"_c"+c,i.classList.add("game_case"),i.innerHTML="&nbsp;",document.getElementsByClassName("line_game_plan")[a].appendChild(i)}}}gridEventsCreation(){for(let t=0;t<this.lines;t++)for(let s=0;s<this.columns;s++){var e=document.getElementById("l"+t+"_c"+s);e.addEventListener("click",()=>{this.first_click||(this.first_click=!0,this.gridCreation(t,s)),"closed"==this.game_table[t][s][1]&&(9==this.game_table[t][s][0]&&(this.allCasesOpen(),this.loosingDisplay()),this.searchAlgo(t,s)),this.cases_open==this.cases_to_win&&(this.allCasesOpen(),this.winningDisplay())}),e.addEventListener("contextmenu",e=>{e.preventDefault(),"closed"==this.game_table[t][s][1]?(this.game_table[t][s][1]="flagged",document.getElementById("l"+t+"_c"+s).classList.add("game_case_flag")):"flagged"==this.game_table[t][s][1]&&(this.game_table[t][s][1]="closed",document.getElementById("l"+t+"_c"+s).classList.remove("game_case_flag"))})}}gridCreation(e,t){let s=0;for(let e=0;e<this.lines;e++)this.game_table[e]=[];for(let e=0;e<this.lines;e++)for(let t=0;t<this.columns;t++)this.game_table[e][t]=[null,"closed"];for(;s<this.nb_mines;){let a=Math.floor(Math.random()*this.lines),l=Math.floor(Math.random()*this.columns);a==e&&l==t||9!=this.game_table[a][l][0]&&(this.game_table[a][l][0]=9,s++)}for(let e=0;e<this.lines;e++)for(let t=0;t<this.columns;t++)this.game_table[e][t][0]=this.searchAdjMinesCase(e,t);this.cases_to_win=this.lines*this.columns-this.nb_mines}searchAdjMinesCase(e,t){var s=0;if(9==this.game_table[e][t][0])return 9;try{9==this.game_table[e-1][t-1][0]&&s++}catch(e){}try{9==this.game_table[e-1][t][0]&&s++}catch(e){}try{9==this.game_table[e-1][t+1][0]&&s++}catch(e){}try{9==this.game_table[e][t-1][0]&&s++}catch(e){}try{9==this.game_table[e][t+1][0]&&s++}catch(e){}try{9==this.game_table[e+1][t-1][0]&&s++}catch(e){}try{9==this.game_table[e+1][t][0]&&s++}catch(e){}try{9==this.game_table[e+1][t+1][0]&&s++}catch(e){}return s}allCasesOpen(){for(let e=0;e<this.lines;e++)for(let t=0;t<this.columns;t++){this.game_table[e][t][1]="open",this.game_table[e][t][0]>0?(document.getElementById("l"+e+"_c"+t).innerHTML=9!=this.game_table[e][t][0]?this.game_table[e][t][0]:null,9==this.game_table[e][t][0]&&document.getElementById("l"+e+"_c"+t).classList.add("game_case_mine")):document.getElementById("l"+e+"_c"+t).innerHTML="&nbsp;";try{document.getElementById("l"+e+"_c"+t).classList.remove("game_case_flag")}catch(e){}document.getElementById("l"+e+"_c"+t).classList.add("game_case_o")}}loosingDisplay(){$("#label_loose").fadeIn("fast")}winningDisplay(){$("#label_win").fadeIn("fast")}searchAlgo2(e,t){if(0==this.game_table[e][t][0]&&"closed"==this.game_table[e][t][1]){this.game_table[e][t][1]="open",this.cases_open++;try{document.getElementById("l"+e+"_c"+t).classList.remove("game_case_flag")}catch(e){}document.getElementById("l"+e+"_c"+t).innerHTML="&nbsp;",document.getElementById("l"+e+"_c"+t).classList.add("game_case_o");try{this.searchAlgo(e-1,t-1)}catch(e){}try{this.searchAlgo(e-1,t)}catch(e){}try{this.searchAlgo(e-1,t+1)}catch(e){}try{this.searchAlgo(e,t-1)}catch(e){}try{this.searchAlgo(e,t+1)}catch(e){}try{this.searchAlgo(e+1,t-1)}catch(e){}try{this.searchAlgo(e+1,t)}catch(e){}try{this.searchAlgo(e+1,t+1)}catch(e){}}else if("closed"==this.game_table[e][t][1]){this.game_table[e][t][1]="open",this.cases_open++,this.game_table[e][t][0]>0?document.getElementById("l"+e+"_c"+t).innerHTML=this.game_table[e][t][0]:document.getElementById("l"+e+"_c"+t).innerHTML="&nbsp;";try{document.getElementById("l"+e+"_c"+t).classList.remove("game_case_flag")}catch(e){}document.getElementById("l"+e+"_c"+t).classList.add("game_case_o")}}searchAlgo(e,t){if("closed"==this.game_table[e][t][1]||"flagged"==this.game_table[e][t][1])if(0==this.game_table[e][t][0]){this.game_table[e][t][1]="open",this.cases_open++;try{document.getElementById("l"+e+"_c"+t).classList.remove("game_case_flag")}catch(e){}document.getElementById("l"+e+"_c"+t).innerHTML="&nbsp;",document.getElementById("l"+e+"_c"+t).classList.add("game_case_o");try{this.searchAlgo(e-1,t-1)}catch(e){}try{this.searchAlgo(e-1,t)}catch(e){}try{this.searchAlgo(e-1,t+1)}catch(e){}try{this.searchAlgo(e,t-1)}catch(e){}try{this.searchAlgo(e,t+1)}catch(e){}try{this.searchAlgo(e+1,t-1)}catch(e){}try{this.searchAlgo(e+1,t)}catch(e){}try{this.searchAlgo(e+1,t+1)}catch(e){}}else{this.game_table[e][t][1]="open",this.cases_open++;try{document.getElementById("l"+e+"_c"+t).classList.remove("game_case_flag")}catch(e){}this.game_table[e][t][0]>0?document.getElementById("l"+e+"_c"+t).innerHTML=this.game_table[e][t][0]:document.getElementById("l"+e+"_c"+t).innerHTML="&nbsp;",document.getElementById("l"+e+"_c"+t).classList.add("game_case_o")}}}